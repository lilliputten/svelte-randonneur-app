import{s as ie,p as pe,a as O,f as S,V as ge,d as P,c as j,g as N,h as W,W as ee,j as L,i as q,K as v,I as _e,D as re,o as he,l as de,m as ce,S as De,n as $e,O as ve}from"../chunks/scheduler.ez7lS21_.js";import{S as fe,i as ue,f as be,b as G,d as K,m as z,a as R,t as H,e as J}from"../chunks/index.aYtyibD9.js";import{w as ne}from"../chunks/index.hn7oF0Js.js";import{g as Fe}from"../chunks/navigation.YUkXmPj8.js";import{l as M,s as Le,L as Pe,v as Y}from"../chunks/FilterActionIcon.module.48C_Vmkf.js";import{g as Q,N as Ee,B as le,P as we}from"../chunks/randoPropertiesActions._SHk_riX.js";import{s as se}from"../chunks/randoDataActions.DDHfJ3Eq.js";function ye(o,a={}){const{fixedPoint:e=2,stripFixedZeros:t=!0}=a;let r=o.toFixed(e);return t&&(r=r.replace(/\.*0+$/,"")),r}function Se(o,a={}){const{normalize:e}=a,t=["B","K","M","G"],r=t.length-1,u=1024;let s=0,n=!1;for(;s<r;){const m=u-o;if(Math.abs(m)<100){n=!0,s++,o=1;break}else if(m>0)break;o/=u,s++}const c=t[s];let _=o;return e&&(_=ye(o,typeof e=="object"?e:void 0)),n&&(_="~"+_),[_,c]}function me(o){if(o){o.includes("NaN")&&(o=o.replace(/(:\s*)NaN($|,)/g,"$1null$2"));try{return JSON.parse(o)}catch(a){const t=["Failed to parse json data",Q(a)].filter(Boolean).join(": "),r=new Error(t);console.error("[loadDemoData:safeParseJson]: error",t,{reason:t,error:a,jsonText:o});debugger;throw r}}}const Ne="/data/",te=[{id:"minimal-1",filename:"minimal-1.json"},{id:"agribalyse-3.1.1-biosphere-ecoinvent-3.8-biosphere",filename:"agribalyse-3.1.1-biosphere-ecoinvent-3.8-biosphere.json"},{id:"ecoinvent-biosphere-3.8-3.9-example",filename:"ecoinvent-biosphere-3.8-3.9-example.json"},{id:"simapro-selection-to-ecoinvent-3.9-biosphere",filename:"simapro-selection-to-ecoinvent-3.9-biosphere.json"},{id:"UVEK-2022-to-ecoinvent-3.9-partial-mining",filename:"UVEK-2022-to-ecoinvent-3.9-partial-mining.json"},{id:"UVEK-2022-to-ecoinvent-3.9-partial-transport",filename:"UVEK-2022-to-ecoinvent-3.9-partial-transport.json"}],Ie=0;function xe(o){const a=te[o].filename;return Ne+a}function Ce(o){return te[o].id}function Me(o){const a=xe(o);return fetch(a).then(e=>{const{ok:t,status:r,statusText:u}=e;if(!t){const s=[u,r&&"status: "+r].filter(Boolean).join(", ")||"Unknown error",n=new Error("Data loading error: "+s);console.error("[loadDemoData:loadDemoDataByIdx]: error (on then)",{reason:s,res:e,dataUrl:a});debugger;throw n}return e.text()}).then(e=>{const t=e&&me(e);if(!t)throw"Received empty data";return t})}function Ue(o,a={}){const{name:e}=o,{onProgress:t,onLoaded:r,onError:u,timeout:s}=a;return new Promise(function(c,_){const m=new FileReader;let h=s?setTimeout(function(){m.abort();const F="Timeout of "+s+'ms exceeded during upload of file "'+e+'"',f=new Error(F);console.error("[loadDataFile] timeout error",{timeoutError:f,timeout:s,fileName:e,fileReader:m});debugger;return u&&u({error:f,fileReader:m}),_(f)},s):void 0;function b(){h&&(clearTimeout(h),h=void 0)}t&&(m.onprogress=function(F){const{lengthComputable:f,loaded:g,total:i}=F,p=f&&i?Math.round(g*100/i):void 0;t({progress:p,loaded:g,total:i,fileReader:m})}),m.onloadend=function(F){const{target:f}=F;try{const g=f?.result,i=g&&me(g);if(!i)throw"Received empty data";return r&&r({data:i,fileReader:m}),c(i)}catch(g){const i=['Data processing error for file "'+e+'"',Q(g)].filter(Boolean).join(": "),p=new Error(i);console.error("[loadDataFile] onloadend: get data error",{dataError:p,error:g});debugger;return u&&u({error:p,fileReader:m}),_(p)}finally{b()}},m.onerror=function(F){const{loaded:f,target:g,type:i}=F;console.error("[loadDataFile] onerror",{fileName:e,loaded:f,target:g,errorType:i,ev:F});let p;if(g){const d=g.error,D=['Data loading error for file "'+e+'"',Q(d)].filter(Boolean).join(": ");p=new Error(D)}else{const d='Unknown data loading error for file "'+e+'"';p=new Error(d)}console.error("[loadDataFile] onerror: event error",{resultError:p});debugger;return u&&u({error:p,fileReader:m}),b(),_(p)},m.readAsText(o)})}const Oe="_LoadDataPage_3a8lb_11",je="_WaiterPanel_3a8lb_22",Be="_inited_3a8lb_37",Te="_goingOut_3a8lb_37",Ve="_loading_3a8lb_37",We="_LoadDataPage_Wrapper_3a8lb_45",ke="_vpadded_3a8lb_61",Ae="_delimited_3a8lb_65",Ge="_formGroup_3a8lb_68",Ke="_FileUploadField_3a8lb_74",$={LoadDataPage:Oe,WaiterPanel:je,inited:Be,goingOut:Te,loading:Ve,LoadDataPage_Wrapper:We,vpadded:ke,delimited:Ae,formGroup:Ge,FileUploadField:Ke};function ze(o){let a;return{c(){a=de("Load demo data")},l(e){a=ce(e,"Load demo data")},m(e,t){q(e,a,t)},d(e){e&&P(a)}}}function Re(o){let a,e,t,r,u,s;return{c(){a=S("span"),e=de(o[1]),t=O(),r=S("input"),this.h()},l(n){a=N(n,"SPAN",{});var c=W(a);e=ce(c,o[1]),c.forEach(P),t=j(n),r=N(n,"INPUT",{type:!0,id:!0,name:!0,accept:!0}),this.h()},h(){L(r,"type","file"),L(r,"id","localDataFile"),L(r,"name","localDataFile"),L(r,"accept","application/json")},m(n,c){q(n,a,c),v(a,e),q(n,t,c),q(n,r,c),u||(s=De(r,"change",o[6]),u=!0)},p(n,c){c&2&&$e(e,n[1])},d(n){n&&(P(a),P(t),P(r)),u=!1,s()}}}function He(o){let a,e;return a=new Pe({}),{c(){G(a.$$.fragment)},l(t){K(a.$$.fragment,t)},m(t,r){z(a,t,r),e=!0},i(t){e||(R(a.$$.fragment,t),e=!0)},o(t){H(a.$$.fragment,t),e=!1},d(t){J(a,t)}}}function Je(o){let a,e,t,r,u="Load data to edit",s,n,c,_="Load demo data",m,h,b,x,F,f,g,i,p,d="Load local data",D,w,y,k,I,A,B;function Z(l){o[11](l)}let ae={data:o[4],id:"demoDataFile",placeholder:"Select demo dataset"};return o[0]!==void 0&&(ae.value=o[0]),b=new Ee({props:ae}),pe.push(()=>be(b,"value",Z)),f=new le({props:{id:"loadDemoDataAction",$$slots:{default:[ze]},$$scope:{ctx:o}}}),f.$on("click",o[5]),y=new le({props:{class:M($.FileUploadField),id:"localDataFile",name:"localDataFile",title:o[1],$$slots:{default:[Re]},$$scope:{ctx:o}}}),I=new we({props:{class:$.WaiterPanel,radius:0,shadow:void 0,$$slots:{default:[He]},$$scope:{ctx:o}}}),{c(){a=O(),e=S("div"),t=S("div"),r=S("h1"),r.textContent=u,s=O(),n=S("section"),c=S("h2"),c.textContent=_,m=O(),h=S("div"),G(b.$$.fragment),F=O(),G(f.$$.fragment),g=O(),i=S("section"),p=S("h2"),p.textContent=d,D=O(),w=S("div"),G(y.$$.fragment),k=O(),G(I.$$.fragment),this.h()},l(l){ge("svelte-8l8mdx",document.head).forEach(P),a=j(l),e=N(l,"DIV",{class:!0});var T=W(e);t=N(T,"DIV",{class:!0});var C=W(t);r=N(C,"H1",{class:!0,"data-svelte-h":!0}),ee(r)!=="svelte-1qoh4x6"&&(r.textContent=u),s=j(C),n=N(C,"SECTION",{id:!0,class:!0});var U=W(n);c=N(U,"H2",{"data-svelte-h":!0}),ee(c)!=="svelte-133invn"&&(c.textContent=_),m=j(U),h=N(U,"DIV",{class:!0});var V=W(h);K(b.$$.fragment,V),F=j(V),K(f.$$.fragment,V),V.forEach(P),U.forEach(P),g=j(C),i=N(C,"SECTION",{id:!0,class:!0});var X=W(i);p=N(X,"H2",{"data-svelte-h":!0}),ee(p)!=="svelte-ua788t"&&(p.textContent=d),D=j(X),w=N(X,"DIV",{class:!0});var oe=W(w);K(y.$$.fragment,oe),oe.forEach(P),X.forEach(P),C.forEach(P),k=j(T),K(I.$$.fragment,T),T.forEach(P),this.h()},h(){document.title="Load data",L(r,"class",M($.header)),L(h,"class",M($.formGroup)),L(n,"id","loadDemoData"),L(n,"class",M($.delimited)),L(w,"class",M($.formGroup)),L(i,"id","loadLocalData"),L(i,"class",M($.delimited)),L(t,"class",M($.LoadDataPage_Wrapper)),L(e,"class",A=M($.LoadDataPage,o[2]&&$.loading,o[8]&&$.goingOut&&o[3]&&$.inited))},m(l,E){q(l,a,E),q(l,e,E),v(e,t),v(t,r),v(t,s),v(t,n),v(n,c),v(n,m),v(n,h),z(b,h,null),v(h,F),z(f,h,null),v(t,g),v(t,i),v(i,p),v(i,D),v(i,w),z(y,w,null),v(e,k),z(I,e,null),B=!0},p(l,[E]){const T={};!x&&E&1&&(x=!0,T.value=l[0],_e(()=>x=!1)),b.$set(T);const C={};E&65536&&(C.$$scope={dirty:E,ctx:l}),f.$set(C);const U={};E&2&&(U.title=l[1]),E&65538&&(U.$$scope={dirty:E,ctx:l}),y.$set(U);const V={};E&65536&&(V.$$scope={dirty:E,ctx:l}),I.$set(V),(!B||E&12&&A!==(A=M($.LoadDataPage,l[2]&&$.loading,l[8]&&$.goingOut&&l[3]&&$.inited)))&&L(e,"class",A)},i(l){B||(R(b.$$.fragment,l),R(f.$$.fragment,l),R(y.$$.fragment,l),R(I.$$.fragment,l),B=!0)},o(l){H(b.$$.fragment,l),H(f.$$.fragment,l),H(y.$$.fragment,l),H(I.$$.fragment,l),B=!1},d(l){l&&(P(a),P(e)),J(b),J(f),J(y),J(I)}}}function qe(o,a,e){let t,r,u;re(o,Le,d=>e(13,r=d));let s=Ie,n=!1,c,_=!1;const m=te.map(({id:d},D)=>({label:d,value:String(D)}));let h="Select and upload local file";function b(){const d=Ce(s);e(9,n=!0),Me(s).then(D=>{se(D),Y({message:"Demo data loading successfully finished",type:"success"}),i()}).catch(D=>{const w=Q(D);console.error("[LoadDataPage:loadDemoData] error",w,{error:D,dataId:d});debugger;Y({message:w,type:"error"})}).finally(()=>{e(9,n=!1)})}function x(d){const w=d.target.files,y=w&&w[0];if(!y){const Z=new Error("No file selected!");console.warn("[LoadDataPage:handleLocalFile] error",{error:Z});return}const{name:k,type:I,size:A}=y;if(!/\.json$/.test(k)||I!=="application/json"){const Z=new Error("Expected json data file!");console.warn("[LoadDataPage:handleLocalFile] error",{error:Z});return}c=y;const B=Se(A,{normalize:!0}).join("");e(1,h=`${k} (${B})`),F()}function F(){if(!c){const d=new Error("No local file defined");console.warn("[LoadDataPage:loadLocalData] error",{error:d});debugger;return}e(10,_=!0),Ue(c,{timeout:5e3}).then(d=>{se(d),Y({message:"Local data loading successfully finished",type:"success"}),i()}).catch(d=>{const D=Q(d);console.error("[LoadDataPage:loadLocalData] error",D,{error:d,localDataFile:c});debugger;Y({message:D,type:"error"}),i()}).finally(()=>{e(10,_=!1)})}const f=ne(!1);re(o,f,d=>e(3,u=d));let g=ne(!1);he(()=>{f.set(!0)});function i(){r&&(g.set(!0),Fe("/data"))}function p(d){s=d,e(0,s)}return o.$$.update=()=>{o.$$.dirty&1536&&e(2,t=n||_)},[s,h,t,u,m,b,x,f,g,n,_,p]}class Ze extends fe{constructor(a){super(),ue(this,a,qe,Je,ie,{})}}function Qe(o){let a,e;return a=new Ze({}),{c(){G(a.$$.fragment)},l(t){K(a.$$.fragment,t)},m(t,r){z(a,t,r),e=!0},p:ve,i(t){e||(R(a.$$.fragment,t),e=!0)},o(t){H(a.$$.fragment,t),e=!1},d(t){J(a,t)}}}class nt extends fe{constructor(a){super(),ue(this,a,null,Qe,ie,{})}}export{nt as component};
