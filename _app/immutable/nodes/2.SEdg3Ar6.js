import{V as _e,s as de,p as he,a as O,f as y,W as De,d as P,c as j,g as N,h as W,X as ee,j as L,i as X,K as v,I as $e,D as re,o as ve,l as ce,m as fe,S as be,n as Fe,O as Le}from"../chunks/scheduler.rsKKbDYC.js";import{S as ue,i as me,f as Pe,b as G,d as K,m as z,a as H,t as J,e as q}from"../chunks/index.DzfArh8w.js";import{w as ne}from"../chunks/index.0WC7A3s9.js";import{r as pe,a as se,e as Ee,B as le,g as we}from"../chunks/navigation.38Fm5qxN.js";import{l as M,L as Se}from"../chunks/index.AOCYmvTY.js";import{s as ye,h as Ne,a as R}from"../chunks/hasDataStore.ZuuwiclO.js";import{N as xe,P as Ie}from"../chunks/deriveDataSetSpec.3gsSxRLa.js";function Q(t){return t?t instanceof Error?t.message:String(t):""}function Ce(t,o={}){const{fixedPoint:e=2,stripFixedZeros:a=!0}=o;let r=t.toFixed(e);return a&&(r=r.replace(/\.*0+$/,"")),r}function Me(t,o={}){const{normalize:e}=o,a=["B","K","M","G"],r=a.length-1,f=1024;let l=0,n=!1;for(;l<r;){const m=f-t;if(Math.abs(m)<100){n=!0,l++,t=1;break}else if(m>0)break;t/=f,l++}const i=a[l];let _=t;return e&&(_=Ce(t,typeof e=="object"?e:void 0)),n&&(_="~"+_),[_,i]}function ge(t){if(t){t.includes("NaN")&&(t=t.replace(/(:\s*)NaN($|,)/g,"$1null$2"));try{return JSON.parse(t)}catch(o){const a=["Failed to parse json data",Q(o)].filter(Boolean).join(": "),r=new Error(a);console.error("[loadDemoData:safeParseJson]: error",a,{reason:a,error:o,jsonText:t});debugger;throw r}}}function Ue(){const t=_e(pe);if(!t){se.set(void 0);return}const{name:o,version:e,description:a,homepage:r,licenses:f,contributors:l,created:n}=t,i={name:o,version:e,description:a,homepage:r,licenses:f,contributors:l,created:n};se.set(i)}function ie(t){pe.set(t);const o=!!t;Ee(),Ue(),ye(o)}const Oe="/data/",te=[{id:"minimal-1",filename:"minimal-1.json"},{id:"agribalyse-3.1.1-biosphere-ecoinvent-3.8-biosphere",filename:"agribalyse-3.1.1-biosphere-ecoinvent-3.8-biosphere.json"},{id:"ecoinvent-biosphere-3.8-3.9-example",filename:"ecoinvent-biosphere-3.8-3.9-example.json"},{id:"simapro-selection-to-ecoinvent-3.9-biosphere",filename:"simapro-selection-to-ecoinvent-3.9-biosphere.json"},{id:"UVEK-2022-to-ecoinvent-3.9-partial-mining",filename:"UVEK-2022-to-ecoinvent-3.9-partial-mining.json"},{id:"UVEK-2022-to-ecoinvent-3.9-partial-transport",filename:"UVEK-2022-to-ecoinvent-3.9-partial-transport.json"}],je=0;function Be(t){const o=te[t].filename;return Oe+o}function Te(t){return te[t].id}function Ve(t){const o=Be(t);return fetch(o).then(e=>{const{ok:a,status:r,statusText:f}=e;if(!a){const l=[f,r&&"status: "+r].filter(Boolean).join(", ")||"Unknown error",n=new Error("Data loading error: "+l);console.error("[loadDemoData:loadDemoDataByIdx]: error (on then)",{reason:l,res:e,dataUrl:o});debugger;throw n}return e.text()}).then(e=>{const a=e&&ge(e);if(!a)throw"Received empty data";return a})}function We(t,o={}){const{name:e}=t,{onProgress:a,onLoaded:r,onError:f,timeout:l}=o;return new Promise(function(i,_){const m=new FileReader;let h=l?setTimeout(function(){m.abort();const F="Timeout of "+l+'ms exceeded during upload of file "'+e+'"',u=new Error(F);console.error("[loadDataFile] timeout error",{timeoutError:u,timeout:l,fileName:e,fileReader:m});debugger;return f&&f({error:u,fileReader:m}),_(u)},l):void 0;function b(){h&&(clearTimeout(h),h=void 0)}a&&(m.onprogress=function(F){const{lengthComputable:u,loaded:g,total:d}=F,p=u&&d?Math.round(g*100/d):void 0;a({progress:p,loaded:g,total:d,fileReader:m})}),m.onloadend=function(F){const{target:u}=F;try{const g=u?.result,d=g&&ge(g);if(!d)throw"Received empty data";return r&&r({data:d,fileReader:m}),i(d)}catch(g){const d=['Data processing error for file "'+e+'"',Q(g)].filter(Boolean).join(": "),p=new Error(d);console.error("[loadDataFile] onloadend: get data error",{dataError:p,error:g});debugger;return f&&f({error:p,fileReader:m}),_(p)}finally{b()}},m.onerror=function(F){const{loaded:u,target:g,type:d}=F;console.error("[loadDataFile] onerror",{fileName:e,loaded:u,target:g,errorType:d,ev:F});let p;if(g){const c=g.error,D=['Data loading error for file "'+e+'"',Q(c)].filter(Boolean).join(": ");p=new Error(D)}else{const c='Unknown data loading error for file "'+e+'"';p=new Error(c)}console.error("[loadDataFile] onerror: event error",{resultError:p});debugger;return f&&f({error:p,fileReader:m}),b(),_(p)},m.readAsText(t)})}const ke="_LoadDataPage_3a8lb_11",Ae="_WaiterPanel_3a8lb_22",Re="_inited_3a8lb_37",Ge="_goingOut_3a8lb_37",Ke="_loading_3a8lb_37",ze="_LoadDataPage_Wrapper_3a8lb_45",He="_vpadded_3a8lb_61",Je="_delimited_3a8lb_65",qe="_formGroup_3a8lb_68",Xe="_FileUploadField_3a8lb_74",$={LoadDataPage:ke,WaiterPanel:Ae,inited:Re,goingOut:Ge,loading:Ke,LoadDataPage_Wrapper:ze,vpadded:He,delimited:Je,formGroup:qe,FileUploadField:Xe};function Ze(t){let o;return{c(){o=ce("Load demo data")},l(e){o=fe(e,"Load demo data")},m(e,a){X(e,o,a)},d(e){e&&P(o)}}}function Qe(t){let o,e,a,r,f,l;return{c(){o=y("span"),e=ce(t[1]),a=O(),r=y("input"),this.h()},l(n){o=N(n,"SPAN",{});var i=W(o);e=fe(i,t[1]),i.forEach(P),a=j(n),r=N(n,"INPUT",{type:!0,id:!0,name:!0,accept:!0}),this.h()},h(){L(r,"type","file"),L(r,"id","localDataFile"),L(r,"name","localDataFile"),L(r,"accept","application/json")},m(n,i){X(n,o,i),v(o,e),X(n,a,i),X(n,r,i),f||(l=be(r,"change",t[6]),f=!0)},p(n,i){i&2&&Fe(e,n[1])},d(n){n&&(P(o),P(a),P(r)),f=!1,l()}}}function Ye(t){let o,e;return o=new Se({}),{c(){G(o.$$.fragment)},l(a){K(o.$$.fragment,a)},m(a,r){z(o,a,r),e=!0},i(a){e||(H(o.$$.fragment,a),e=!0)},o(a){J(o.$$.fragment,a),e=!1},d(a){q(o,a)}}}function et(t){let o,e,a,r,f="Load data to edit",l,n,i,_="Load demo data",m,h,b,I,F,u,g,d,p,c="Load local data",D,w,S,k,x,A,B;function Z(s){t[11](s)}let ae={data:t[4],id:"demoDataFile",placeholder:"Select demo dataset"};return t[0]!==void 0&&(ae.value=t[0]),b=new xe({props:ae}),he.push(()=>Pe(b,"value",Z)),u=new le({props:{id:"loadDemoDataAction",$$slots:{default:[Ze]},$$scope:{ctx:t}}}),u.$on("click",t[5]),S=new le({props:{class:M($.FileUploadField),id:"localDataFile",name:"localDataFile",title:t[1],$$slots:{default:[Qe]},$$scope:{ctx:t}}}),x=new Ie({props:{class:$.WaiterPanel,radius:0,shadow:void 0,$$slots:{default:[Ye]},$$scope:{ctx:t}}}),{c(){o=O(),e=y("div"),a=y("div"),r=y("h1"),r.textContent=f,l=O(),n=y("section"),i=y("h2"),i.textContent=_,m=O(),h=y("div"),G(b.$$.fragment),F=O(),G(u.$$.fragment),g=O(),d=y("section"),p=y("h2"),p.textContent=c,D=O(),w=y("div"),G(S.$$.fragment),k=O(),G(x.$$.fragment),this.h()},l(s){De("svelte-8l8mdx",document.head).forEach(P),o=j(s),e=N(s,"DIV",{class:!0});var T=W(e);a=N(T,"DIV",{class:!0});var C=W(a);r=N(C,"H1",{class:!0,"data-svelte-h":!0}),ee(r)!=="svelte-1qoh4x6"&&(r.textContent=f),l=j(C),n=N(C,"SECTION",{id:!0,class:!0});var U=W(n);i=N(U,"H2",{"data-svelte-h":!0}),ee(i)!=="svelte-133invn"&&(i.textContent=_),m=j(U),h=N(U,"DIV",{class:!0});var V=W(h);K(b.$$.fragment,V),F=j(V),K(u.$$.fragment,V),V.forEach(P),U.forEach(P),g=j(C),d=N(C,"SECTION",{id:!0,class:!0});var Y=W(d);p=N(Y,"H2",{"data-svelte-h":!0}),ee(p)!=="svelte-ua788t"&&(p.textContent=c),D=j(Y),w=N(Y,"DIV",{class:!0});var oe=W(w);K(S.$$.fragment,oe),oe.forEach(P),Y.forEach(P),C.forEach(P),k=j(T),K(x.$$.fragment,T),T.forEach(P),this.h()},h(){document.title="Load data",L(r,"class",M($.header)),L(h,"class",M($.formGroup)),L(n,"id","loadDemoData"),L(n,"class",M($.delimited)),L(w,"class",M($.formGroup)),L(d,"id","loadLocalData"),L(d,"class",M($.delimited)),L(a,"class",M($.LoadDataPage_Wrapper)),L(e,"class",A=M($.LoadDataPage,t[2]&&$.loading,t[8]&&$.goingOut&&t[3]&&$.inited))},m(s,E){X(s,o,E),X(s,e,E),v(e,a),v(a,r),v(a,l),v(a,n),v(n,i),v(n,m),v(n,h),z(b,h,null),v(h,F),z(u,h,null),v(a,g),v(a,d),v(d,p),v(d,D),v(d,w),z(S,w,null),v(e,k),z(x,e,null),B=!0},p(s,[E]){const T={};!I&&E&1&&(I=!0,T.value=s[0],$e(()=>I=!1)),b.$set(T);const C={};E&65536&&(C.$$scope={dirty:E,ctx:s}),u.$set(C);const U={};E&2&&(U.title=s[1]),E&65538&&(U.$$scope={dirty:E,ctx:s}),S.$set(U);const V={};E&65536&&(V.$$scope={dirty:E,ctx:s}),x.$set(V),(!B||E&12&&A!==(A=M($.LoadDataPage,s[2]&&$.loading,s[8]&&$.goingOut&&s[3]&&$.inited)))&&L(e,"class",A)},i(s){B||(H(b.$$.fragment,s),H(u.$$.fragment,s),H(S.$$.fragment,s),H(x.$$.fragment,s),B=!0)},o(s){J(b.$$.fragment,s),J(u.$$.fragment,s),J(S.$$.fragment,s),J(x.$$.fragment,s),B=!1},d(s){s&&(P(o),P(e)),q(b),q(u),q(S),q(x)}}}function tt(t,o,e){let a,r,f;re(t,Ne,c=>e(13,r=c));let l=je,n=!1,i,_=!1;const m=te.map(({id:c},D)=>({label:c,value:String(D)}));let h="Select and upload local file";function b(){const c=Te(l);e(9,n=!0),R({message:"Demo data loading started",type:"info"}),Ve(l).then(D=>{ie(D),R({message:"Demo data loading successfully finished",type:"success"}),d()}).catch(D=>{const w=Q(D);console.error("[LoadDataPage:loadDemoData] error",w,{error:D,dataId:c});debugger;R({message:w,type:"error"})}).finally(()=>{e(9,n=!1)})}function I(c){const w=c.target.files,S=w&&w[0];if(!S){const Z=new Error("No file selected!");console.warn("[LoadDataPage:handleLocalFile] error",{error:Z});return}const{name:k,type:x,size:A}=S;if(!/\.json$/.test(k)||x!=="application/json"){const Z=new Error("Expected json data file!");console.warn("[LoadDataPage:handleLocalFile] error",{error:Z});return}i=S;const B=Me(A,{normalize:!0}).join("");e(1,h=`${k} (${B})`),F()}function F(){if(!i){const c=new Error("No local file defined");console.warn("[LoadDataPage:loadLocalData] error",{error:c});debugger;return}R({message:"Local data loading started",type:"info"}),e(10,_=!0),We(i,{timeout:5e3}).then(c=>{ie(c),R({message:"Local data loading successfully finished",type:"success"}),d()}).catch(c=>{const D=Q(c);console.error("[LoadDataPage:loadLocalData] error",D,{error:c,localDataFile:i});debugger;R({message:D,type:"error"}),d()}).finally(()=>{e(10,_=!1)})}const u=ne(!1);re(t,u,c=>e(3,f=c));let g=ne(!1);ve(()=>{u.set(!0)});function d(){r&&(g.set(!0),we("/data"))}function p(c){l=c,e(0,l)}return t.$$.update=()=>{t.$$.dirty&1536&&e(2,a=n||_)},[l,h,a,f,m,b,I,u,g,n,_,p]}class at extends ue{constructor(o){super(),me(this,o,tt,et,de,{})}}function ot(t){let o,e;return o=new at({}),{c(){G(o.$$.fragment)},l(a){K(o.$$.fragment,a)},m(a,r){z(o,a,r),e=!0},p:Le,i(a){e||(H(o.$$.fragment,a),e=!0)},o(a){J(o.$$.fragment,a),e=!1},d(a){q(o,a)}}}class ft extends ue{constructor(o){super(),me(this,o,null,ot,de,{})}}export{ft as component};
