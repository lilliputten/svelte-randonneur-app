import{s as ie,p as pe,a as O,f as y,V as ge,d as P,c as j,g as N,h as W,W as ee,j as L,i as q,K as v,I as _e,D as re,o as he,l as de,m as ce,S as De,n as $e,O as ve}from"../chunks/scheduler.D9i2_oPc.js";import{S as fe,i as ue,f as be,b as R,d as G,m as K,a as z,t as H,e as J}from"../chunks/index.hhuPaoSW.js";import{w as ne}from"../chunks/index.RFOEB-ae.js";import{g as Q,r as Fe,e as Le,a as Pe,b as Ee}from"../chunks/navigation.5yvXZHHb.js";import{l as M,L as we}from"../chunks/FilterActionIcon.module.QY3rxjnu.js";import{s as Se,h as ye,a as Y}from"../chunks/hasDataStore.DrD_3SsW.js";import{N as Ne,B as se,P as xe}from"../chunks/extendDataSetWithFilters.K91ioLcD.js";function Ie(a,o={}){const{fixedPoint:e=2,stripFixedZeros:t=!0}=o;let r=a.toFixed(e);return t&&(r=r.replace(/\.*0+$/,"")),r}function Ce(a,o={}){const{normalize:e}=o,t=["B","K","M","G"],r=t.length-1,u=1024;let l=0,n=!1;for(;l<r;){const m=u-a;if(Math.abs(m)<100){n=!0,l++,a=1;break}else if(m>0)break;a/=u,l++}const c=t[l];let _=a;return e&&(_=Ie(a,typeof e=="object"?e:void 0)),n&&(_="~"+_),[_,c]}function me(a){if(a){a.includes("NaN")&&(a=a.replace(/(:\s*)NaN($|,)/g,"$1null$2"));try{return JSON.parse(a)}catch(o){const t=["Failed to parse json data",Q(o)].filter(Boolean).join(": "),r=new Error(t);console.error("[loadDemoData:safeParseJson]: error",t,{reason:t,error:o,jsonText:a});debugger;throw r}}}function le(a){Fe.set(a);const o=!!a;Le(),Pe(),Se(o)}const Me="/data/",te=[{id:"minimal-1",filename:"minimal-1.json"},{id:"agribalyse-3.1.1-biosphere-ecoinvent-3.8-biosphere",filename:"agribalyse-3.1.1-biosphere-ecoinvent-3.8-biosphere.json"},{id:"ecoinvent-biosphere-3.8-3.9-example",filename:"ecoinvent-biosphere-3.8-3.9-example.json"},{id:"simapro-selection-to-ecoinvent-3.9-biosphere",filename:"simapro-selection-to-ecoinvent-3.9-biosphere.json"},{id:"UVEK-2022-to-ecoinvent-3.9-partial-mining",filename:"UVEK-2022-to-ecoinvent-3.9-partial-mining.json"},{id:"UVEK-2022-to-ecoinvent-3.9-partial-transport",filename:"UVEK-2022-to-ecoinvent-3.9-partial-transport.json"}],Ue=0;function Oe(a){const o=te[a].filename;return Me+o}function je(a){return te[a].id}function Be(a){const o=Oe(a);return fetch(o).then(e=>{const{ok:t,status:r,statusText:u}=e;if(!t){const l=[u,r&&"status: "+r].filter(Boolean).join(", ")||"Unknown error",n=new Error("Data loading error: "+l);console.error("[loadDemoData:loadDemoDataByIdx]: error (on then)",{reason:l,res:e,dataUrl:o});debugger;throw n}return e.text()}).then(e=>{const t=e&&me(e);if(!t)throw"Received empty data";return t})}function Te(a,o={}){const{name:e}=a,{onProgress:t,onLoaded:r,onError:u,timeout:l}=o;return new Promise(function(c,_){const m=new FileReader;let h=l?setTimeout(function(){m.abort();const F="Timeout of "+l+'ms exceeded during upload of file "'+e+'"',f=new Error(F);console.error("[loadDataFile] timeout error",{timeoutError:f,timeout:l,fileName:e,fileReader:m});debugger;return u&&u({error:f,fileReader:m}),_(f)},l):void 0;function b(){h&&(clearTimeout(h),h=void 0)}t&&(m.onprogress=function(F){const{lengthComputable:f,loaded:g,total:i}=F,p=f&&i?Math.round(g*100/i):void 0;t({progress:p,loaded:g,total:i,fileReader:m})}),m.onloadend=function(F){const{target:f}=F;try{const g=f?.result,i=g&&me(g);if(!i)throw"Received empty data";return r&&r({data:i,fileReader:m}),c(i)}catch(g){const i=['Data processing error for file "'+e+'"',Q(g)].filter(Boolean).join(": "),p=new Error(i);console.error("[loadDataFile] onloadend: get data error",{dataError:p,error:g});debugger;return u&&u({error:p,fileReader:m}),_(p)}finally{b()}},m.onerror=function(F){const{loaded:f,target:g,type:i}=F;console.error("[loadDataFile] onerror",{fileName:e,loaded:f,target:g,errorType:i,ev:F});let p;if(g){const d=g.error,D=['Data loading error for file "'+e+'"',Q(d)].filter(Boolean).join(": ");p=new Error(D)}else{const d='Unknown data loading error for file "'+e+'"';p=new Error(d)}console.error("[loadDataFile] onerror: event error",{resultError:p});debugger;return u&&u({error:p,fileReader:m}),b(),_(p)},m.readAsText(a)})}const Ve="_LoadDataPage_3a8lb_11",We="_WaiterPanel_3a8lb_22",ke="_inited_3a8lb_37",Ae="_goingOut_3a8lb_37",Re="_loading_3a8lb_37",Ge="_LoadDataPage_Wrapper_3a8lb_45",Ke="_vpadded_3a8lb_61",ze="_delimited_3a8lb_65",He="_formGroup_3a8lb_68",Je="_FileUploadField_3a8lb_74",$={LoadDataPage:Ve,WaiterPanel:We,inited:ke,goingOut:Ae,loading:Re,LoadDataPage_Wrapper:Ge,vpadded:Ke,delimited:ze,formGroup:He,FileUploadField:Je};function qe(a){let o;return{c(){o=de("Load demo data")},l(e){o=ce(e,"Load demo data")},m(e,t){q(e,o,t)},d(e){e&&P(o)}}}function Ze(a){let o,e,t,r,u,l;return{c(){o=y("span"),e=de(a[1]),t=O(),r=y("input"),this.h()},l(n){o=N(n,"SPAN",{});var c=W(o);e=ce(c,a[1]),c.forEach(P),t=j(n),r=N(n,"INPUT",{type:!0,id:!0,name:!0,accept:!0}),this.h()},h(){L(r,"type","file"),L(r,"id","localDataFile"),L(r,"name","localDataFile"),L(r,"accept","application/json")},m(n,c){q(n,o,c),v(o,e),q(n,t,c),q(n,r,c),u||(l=De(r,"change",a[6]),u=!0)},p(n,c){c&2&&$e(e,n[1])},d(n){n&&(P(o),P(t),P(r)),u=!1,l()}}}function Qe(a){let o,e;return o=new we({}),{c(){R(o.$$.fragment)},l(t){G(o.$$.fragment,t)},m(t,r){K(o,t,r),e=!0},i(t){e||(z(o.$$.fragment,t),e=!0)},o(t){H(o.$$.fragment,t),e=!1},d(t){J(o,t)}}}function Xe(a){let o,e,t,r,u="Load data to edit",l,n,c,_="Load demo data",m,h,b,I,F,f,g,i,p,d="Load local data",D,w,S,k,x,A,B;function Z(s){a[11](s)}let ae={data:a[4],id:"demoDataFile",placeholder:"Select demo dataset"};return a[0]!==void 0&&(ae.value=a[0]),b=new Ne({props:ae}),pe.push(()=>be(b,"value",Z)),f=new se({props:{id:"loadDemoDataAction",$$slots:{default:[qe]},$$scope:{ctx:a}}}),f.$on("click",a[5]),S=new se({props:{class:M($.FileUploadField),id:"localDataFile",name:"localDataFile",title:a[1],$$slots:{default:[Ze]},$$scope:{ctx:a}}}),x=new xe({props:{class:$.WaiterPanel,radius:0,shadow:void 0,$$slots:{default:[Qe]},$$scope:{ctx:a}}}),{c(){o=O(),e=y("div"),t=y("div"),r=y("h1"),r.textContent=u,l=O(),n=y("section"),c=y("h2"),c.textContent=_,m=O(),h=y("div"),R(b.$$.fragment),F=O(),R(f.$$.fragment),g=O(),i=y("section"),p=y("h2"),p.textContent=d,D=O(),w=y("div"),R(S.$$.fragment),k=O(),R(x.$$.fragment),this.h()},l(s){ge("svelte-8l8mdx",document.head).forEach(P),o=j(s),e=N(s,"DIV",{class:!0});var T=W(e);t=N(T,"DIV",{class:!0});var C=W(t);r=N(C,"H1",{class:!0,"data-svelte-h":!0}),ee(r)!=="svelte-1qoh4x6"&&(r.textContent=u),l=j(C),n=N(C,"SECTION",{id:!0,class:!0});var U=W(n);c=N(U,"H2",{"data-svelte-h":!0}),ee(c)!=="svelte-133invn"&&(c.textContent=_),m=j(U),h=N(U,"DIV",{class:!0});var V=W(h);G(b.$$.fragment,V),F=j(V),G(f.$$.fragment,V),V.forEach(P),U.forEach(P),g=j(C),i=N(C,"SECTION",{id:!0,class:!0});var X=W(i);p=N(X,"H2",{"data-svelte-h":!0}),ee(p)!=="svelte-ua788t"&&(p.textContent=d),D=j(X),w=N(X,"DIV",{class:!0});var oe=W(w);G(S.$$.fragment,oe),oe.forEach(P),X.forEach(P),C.forEach(P),k=j(T),G(x.$$.fragment,T),T.forEach(P),this.h()},h(){document.title="Load data",L(r,"class",M($.header)),L(h,"class",M($.formGroup)),L(n,"id","loadDemoData"),L(n,"class",M($.delimited)),L(w,"class",M($.formGroup)),L(i,"id","loadLocalData"),L(i,"class",M($.delimited)),L(t,"class",M($.LoadDataPage_Wrapper)),L(e,"class",A=M($.LoadDataPage,a[2]&&$.loading,a[8]&&$.goingOut&&a[3]&&$.inited))},m(s,E){q(s,o,E),q(s,e,E),v(e,t),v(t,r),v(t,l),v(t,n),v(n,c),v(n,m),v(n,h),K(b,h,null),v(h,F),K(f,h,null),v(t,g),v(t,i),v(i,p),v(i,D),v(i,w),K(S,w,null),v(e,k),K(x,e,null),B=!0},p(s,[E]){const T={};!I&&E&1&&(I=!0,T.value=s[0],_e(()=>I=!1)),b.$set(T);const C={};E&65536&&(C.$$scope={dirty:E,ctx:s}),f.$set(C);const U={};E&2&&(U.title=s[1]),E&65538&&(U.$$scope={dirty:E,ctx:s}),S.$set(U);const V={};E&65536&&(V.$$scope={dirty:E,ctx:s}),x.$set(V),(!B||E&12&&A!==(A=M($.LoadDataPage,s[2]&&$.loading,s[8]&&$.goingOut&&s[3]&&$.inited)))&&L(e,"class",A)},i(s){B||(z(b.$$.fragment,s),z(f.$$.fragment,s),z(S.$$.fragment,s),z(x.$$.fragment,s),B=!0)},o(s){H(b.$$.fragment,s),H(f.$$.fragment,s),H(S.$$.fragment,s),H(x.$$.fragment,s),B=!1},d(s){s&&(P(o),P(e)),J(b),J(f),J(S),J(x)}}}function Ye(a,o,e){let t,r,u;re(a,ye,d=>e(13,r=d));let l=Ue,n=!1,c,_=!1;const m=te.map(({id:d},D)=>({label:d,value:String(D)}));let h="Select and upload local file";function b(){const d=je(l);e(9,n=!0),Be(l).then(D=>{le(D),Y({message:"Demo data loading successfully finished",type:"success"}),i()}).catch(D=>{const w=Q(D);console.error("[LoadDataPage:loadDemoData] error",w,{error:D,dataId:d});debugger;Y({message:w,type:"error"})}).finally(()=>{e(9,n=!1)})}function I(d){const w=d.target.files,S=w&&w[0];if(!S){const Z=new Error("No file selected!");console.warn("[LoadDataPage:handleLocalFile] error",{error:Z});return}const{name:k,type:x,size:A}=S;if(!/\.json$/.test(k)||x!=="application/json"){const Z=new Error("Expected json data file!");console.warn("[LoadDataPage:handleLocalFile] error",{error:Z});return}c=S;const B=Ce(A,{normalize:!0}).join("");e(1,h=`${k} (${B})`),F()}function F(){if(!c){const d=new Error("No local file defined");console.warn("[LoadDataPage:loadLocalData] error",{error:d});debugger;return}e(10,_=!0),Te(c,{timeout:5e3}).then(d=>{le(d),Y({message:"Local data loading successfully finished",type:"success"}),i()}).catch(d=>{const D=Q(d);console.error("[LoadDataPage:loadLocalData] error",D,{error:d,localDataFile:c});debugger;Y({message:D,type:"error"}),i()}).finally(()=>{e(10,_=!1)})}const f=ne(!1);re(a,f,d=>e(3,u=d));let g=ne(!1);he(()=>{f.set(!0)});function i(){r&&(g.set(!0),Ee("/data"))}function p(d){l=d,e(0,l)}return a.$$.update=()=>{a.$$.dirty&1536&&e(2,t=n||_)},[l,h,t,u,m,b,I,f,g,n,_,p]}class et extends fe{constructor(o){super(),ue(this,o,Ye,Xe,ie,{})}}function tt(a){let o,e;return o=new et({}),{c(){R(o.$$.fragment)},l(t){G(o.$$.fragment,t)},m(t,r){K(o,t,r),e=!0},p:ve,i(t){e||(z(o.$$.fragment,t),e=!0)},o(t){H(o.$$.fragment,t),e=!1},d(t){J(o,t)}}}class dt extends fe{constructor(o){super(),ue(this,o,null,tt,ie,{})}}export{dt as component};
